<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ZapsyGo</title>

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Remix Icon & FontAwesome -->
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.3.0/fonts/remixicon.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

    <!-- CSS -->
    <link rel="stylesheet" href="style2.css" />
    <link rel="stylesheet" href="styles.css" />

     <!-- Preloader Style -->
        <style>
      #preloader {
        position: fixed;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        z-index: 9999;
        background-color: #ffffff;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .spinner {
        width: 60px;
        height: 60px;
        border: 8px solid #eee;
        border-top: 8px solid #2560a3;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg fixed-top">
      <div class="container">
        <a class="navbar-brand fw-bold" href="#">ZapsyGo</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
          <ul class="navbar-nav gap-2 m-auto">
            <li class="nav-item"><a class="nav-link" href="index.html">BERANDA</a></li>
            <li class="nav-item"><a class="nav-link" href="about.html">TENTANG KAMI</a></li>
            <li class="nav-item"><a class="nav-link" href="itinerary.html">ITINERARY</a></li>
            <li class="nav-item"><a class="nav-link" href="destinasi.html">DESTINASI</a></li>
          </ul>
          <ul class="navbar-nav gap-2">
            <!-- Tombol Masuk (untuk user belum login) -->
            <li class="nav-item" id="loginButton">
              <a class="btn fw-bold px-3" href="log2.html">MASUK</a>
            </li>

            <!-- Dropdown Profil (hanya muncul jika sudah login) -->
            <li class="nav-item dropdown d-none" id="profileDropdown">
              <a class="nav-link dropdown-toggle d-flex align-items-center gap-2" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                <i class="fas fa-user-circle fs-4"></i> <span>Profil</span>
              </a>
              <ul class="dropdown-menu dropdown-menu-end">
                <li><a class="dropdown-item" href="profile.html">Profil Saya</a></li>
                <li><hr class="dropdown-divider" /></li>
                <li><a class="dropdown-item text-danger" href="logout.html">Logout </a></li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
          <div id="preloader">
      <div class="spinner"></div>
    </div>
    </nav>

    <div class="container" style="padding-top: 100px; padding-bottom: 50px">
      <div class="mb-4">
        <a href="javascript:history.back()" class="btn btn-kembali d-inline-flex align-items-center shadow px-4 py-2"> <i class="fas fa-arrow-left me-2"></i> Kembali </a>
      </div>

      <div class="row g-4">
        <div class="col-lg-7 d-flex flex-column gap-4">
          <div class="form-pax shadow p-4 rounded d-flex flex-column">
            <h2 class="fw-bold text-start mb-3" style="color: #2560a3">Jumlah Pax</h2>
            <div class="w-100">
              <button class="btn btn-outline-custom rounded-pill w-100 px-4 py-2 dropdown-toggle-custom" type="button" id="paxButton" onclick="toggleOptions()">
                <i class="fas fa-chevron-down"></i>
                <span class="ms-auto" id="selectedPax">Pilih Jumlah Pax</span>
              </button>
              <div id="paxOptions" class="option-list mt-2 d-none">
                <a href="#" onclick="selectPax('1 Pax')">1 Pax</a>
                <a href="#" onclick="selectPax('2 Pax')">2 Pax</a>
                <a href="#" onclick="selectPax('3 Pax')">3 Pax</a>
                <a href="#" onclick="selectPax('4 Pax')">4 Pax</a>
                <a href="#" onclick="selectPax('5 Pax')">5 Pax</a>
              </div>
            </div>
          </div>

          <div class="form-pemesanan shadow p-4 rounded d-flex flex-column">
            <h2 class="fw-bold text-start mb-3" style="color: #2560a3">Formulir Pemesanan</h2>
            <form onsubmit="handleSubmit(event)" class="form-outline-custom">
              <div class="mb-3">
                <label for="namaLengkap" class="form-label">Nama Lengkap</label>
                <input type="text" class="form-control" id="namaLengkap" required />
              </div>
              <div class="mb-3">
                <label for="tanggal" class="form-label">Pilih tanggal keberangkatan</label>
                <input type="date" class="form-control" id="tanggal" required />
              </div>
              <div class="mb-3">
                <label for="email" class="form-label">Email</label>
                <input type="email" class="form-control" id="email" required />
              </div>
              <div class="mb-4">
                <label for="noHp" class="form-label">No HP</label>
                <input type="tel" class="form-control" id="noHp" required />
              </div>
            </form>
          </div>
        </div>

        <div class="col-lg-5">
          <div class="custom-card bg-white">
            <h1 class="fw-bold mb-3" style="color: #2560a3">Ringkasan</h1>
            <h5 class="fw-bold text-uppercase mb-4">Tour Elyora 1 Hari</h5>

            <div class="d-flex align-items-center gap-2 mb-4">
              <i class="ri-user-3-line text-primary fs-5"></i>
              <span id="paxDisplay">- Pax</span>
            </div>
            <div class="d-flex align-items-center gap-2 mb-2">
              <i class="ri-calendar-line text-primary fs-5"></i>
              <span id="tanggalDisplay">-</span>
            </div>
            <p class="mb-4">Jika sudah benar, silakan klik tombol di<br />bawah ini untuk menyelesaikan pesanan.</p>
            <a id="pesanSekarangBtn" href="#" class="btn w-100 py-2 fw-bold text-white rounded-pill" style="background-color: #2560a3">Pesan Sekarang</a>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer id="contact" class="py-5" style="background-color: #2560a3; color: white">
      <div class="container">
        <div class="row gy-4">
          <!-- Kolom 1: Logo dan Deskripsi -->
          <div class="col-md-4">
            <div class="footer__logo mb-2">
              <a href="#" class="logo fs-4 fw-bold text-decoration-none text-white">ZapsyGo</a>
            </div>
            <p>Explore the world with ease and excitement through our comprehensive travel platform. Your journey begins here, where seamless planning meets unforgettable experiences.</p>
            <ul class="list-inline mt-3 footer__socials">
              <li class="list-inline-item">
                <a href="#"><i class="ri-facebook-fill fs-5 text-white"></i></a>
              </li>
              <li class="list-inline-item">
                <a href="#"><i class="ri-instagram-line fs-5 text-white"></i></a>
              </li>
              <li class="list-inline-item">
                <a href="#"><i class="ri-youtube-line fs-5 text-white"></i></a>
              </li>
            </ul>
          </div>

          <!-- Kolom 2: Akses Cepat -->
          <div class="col-md-4">
            <h5 class="mb-3 fw-bold text-white">Akses Cepat</h5>
            <ul class="list-unstyled footer__links">
              <li><a href="index.html" class="text-decoration-none text-white">Beranda</a></li>
              <li><a href="#" class="text-decoration-none text-white">Destinasi</a></li>
              <li><a href="#" class="text-decoration-none text-white">Hotel</a></li>
              <li><a href="#" class="text-decoration-none text-white">Tentang Kami</a></li>
            </ul>
          </div>

          <!-- Kolom 3: Kontak -->
          <div class="col-md-4">
            <h5 class="mb-3 fw-bold text-white">Kontak Kami</h5>
            <ul class="list-unstyled footer__links">
              <li class="mb-2">
                <a href="#" class="text-decoration-none text-white"> <i class="ri-phone-fill me-2"></i> +62918278129 </a>
              </li>
              <li class="mb-2">
                <a href="#" class="text-decoration-none text-white"> <i class="ri-record-mail-line me-2"></i> info@zapsygo </a>
              </li>
              <li>
                <a href="#" class="text-decoration-none text-white"> <i class="ri-map-pin-2-fill me-2"></i> Batam, Indonesia </a>
              </li>
            </ul>
          </div>
        </div>

        <!-- Footer bar -->
        <div class="text-center mt-4 footer__bar text-white small">Copyright Â© 2025 ZapsyGo. All rights reserved.</div>
      </div>
    </footer>

<script>
  // Preloader hide saat halaman selesai load
  window.addEventListener("load", function () {
    const preloader = document.getElementById("preloader");
    if (preloader) {
      preloader.style.opacity = "0";
      preloader.style.transition = "opacity 0.5s ease";
      setTimeout(() => {
        preloader.style.display = "none";
      }, 500);
    }
  });

  let selectedPax = "-";

  function toggleOptions() {
    const list = document.getElementById("paxOptions");
    list.classList.toggle("d-none");
  }

  function selectPax(value) {
    selectedPax = value;
    document.getElementById("selectedPax").textContent = value;
    document.getElementById("paxDisplay").textContent = value;
    toggleOptions();
  }

  function handleSubmit(event) {
    event.preventDefault();
    const tanggal = document.getElementById("tanggal").value;
    document.getElementById("tanggalDisplay").textContent = tanggal;
  }

  document.addEventListener("DOMContentLoaded", function () {
    // Menampilkan tanggal yang dipilih
    document.getElementById("tanggal").addEventListener("change", function () {
      document.getElementById("tanggalDisplay").textContent = this.value;
    });

    // Ambil status login dan data pengguna dari localStorage
    const isLoggedIn = localStorage.getItem("isLoggedIn") === "true";
    const username = localStorage.getItem("username") || "Profil";

    const loginBtn = document.getElementById("loginButton");
    const profileDropdown = document.getElementById("profileDropdown");

    loginBtn.classList.toggle("d-none", isLoggedIn);
    profileDropdown.classList.toggle("d-none", !isLoggedIn);

    if (isLoggedIn) {
      // Ambil foto profil dari backend
      fetch(`http://localhost:5000/api/profile?username=${username}`)
        .then(res => res.json())
        .then(data => {
          const dropdownLink = profileDropdown.querySelector("a.nav-link");
          let photoURL = data.photo;

          // Pastikan URL valid
          if (photoURL && !photoURL.startsWith("http")) {
            photoURL = `http://localhost:5000/uploads/${photoURL.split('\\').pop().split('/').pop()}`;
          }

          if (photoURL) {
            const icon = dropdownLink.querySelector("i");
            if (icon) icon.remove();

            dropdownLink.innerHTML = `
              <img src="${photoURL}" alt="Foto" class="rounded-circle me-2" style="width: 32px; height: 32px; object-fit: cover;">
              <span>${username}</span>
            `;
          } else {
            dropdownLink.innerHTML = `
              <i class="fas fa-user-circle fs-4"></i> <span>${username}</span>
            `;
          }
        })
        .catch(err => {
          console.error("Gagal memuat foto profil:", err);
        });
    }

    // Tombol "Pesan Sekarang"
    document.getElementById("pesanSekarangBtn").addEventListener("click", function (e) {
      e.preventDefault();

      const paxText = selectedPax || document.getElementById("selectedPax").textContent;
      const tanggal = document.getElementById("tanggal").value;

      if (!paxText || paxText === "-" || !tanggal) {
        alert("Silakan pilih jumlah pax dan tanggal terlebih dahulu.");
        return;
      }

      const pax = parseInt(paxText); // dari "2 Pax" menjadi 2
      const hargaPerPax = 150000;
      const biayaLayanan = 1000;
      const total = pax * hargaPerPax + biayaLayanan;

      const virtualAccount = "80777089237889088";

      localStorage.setItem(
        "status_pesanan",
        JSON.stringify({
          pax: pax,
          tanggal: tanggal,
          total_tagihan: "Rp " + total.toLocaleString("id-ID"),
          virtual_account: virtualAccount,
        })
      );

      window.location.href = "pembayaran.html";
    });
  });
</script>

  </body>
</html>
